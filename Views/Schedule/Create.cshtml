@model AspnetCoreMvcFull.Models.Schedule

@{
	ViewData["Title"] = "Create Schedule";
}

<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header">
					<h4 class="card-title mb-0">
						<i class="fas fa-calendar-plus"></i> Create New Schedule
					</h4>
				</div>
				<div class="card-body">
					@if (ViewBag.ErrorMessage != null)
					{
						<div class="alert alert-danger">
							@ViewBag.ErrorMessage
						</div>
					}

					<!-- ADD THE DEBUG CODE HERE -->
					@if (ViewBag.Trucks != null)
					{
						<div class="alert alert-info">
							<strong>Debug Info:</strong><br>
							Trucks loaded: @((ViewBag.Trucks as List<AspnetCoreMvcFull.Models.Truck>)?.Count ?? 0)<br>
							Collectors loaded: @((ViewBag.Collectors as List<AspnetCoreMvcFull.Models.User>)?.Count ?? 0)<br>
							Routes loaded: @((ViewBag.Routes as List<AspnetCoreMvcFull.Models.RoutePlan>)?.Count ?? 0)
						</div>
					}
					<!-- END DEBUG CODE -->

					<form asp-action="Create" method="post">
						<div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

						<div class="row">
							<div class="col-md-6">
								<!-- Truck Dropdown - populated from your Truck CRUD -->
								<div class="form-group mb-3">
									<label asp-for="TruckId" class="form-label">
										<i class="fas fa-truck"></i> Select Truck
									</label>
									<select asp-for="TruckId" class="form-select" required>
										<option value="">-- Select Truck --</option>
										@if (ViewBag.Trucks != null)
										{
											@foreach (var truck in ViewBag.Trucks)
											{
												<option value="@truck.Id">
													@truck.LicensePlate - @truck.Model
													<span class="badge bg-success">@truck.Status</span>
												</option>
											}
										}
										else
										{
											<option disabled>No trucks available</option>
										}
									</select>
									<div class="form-text">
										Only available trucks are shown.
										<a asp-controller="Truck" asp-action="Create" target="_blank">Create new truck</a> if needed.
									</div>
									<span asp-validation-for="TruckId" class="text-danger"></span>
								</div>
							</div>

							<div class="col-md-6">
								<!-- Collector Dropdown -->
								<div class="form-group mb-3">
									<label asp-for="CollectorId" class="form-label">
										<i class="fas fa-user"></i> Select Collector
									</label>
									<select asp-for="CollectorId" class="form-select" required>
										<option value="">-- Select Collector --</option>
										@if (ViewBag.Collectors != null)
										{
											@foreach (var collector in ViewBag.Collectors)
											{
												<option value="@collector.Id">@collector.FirstName @collector.LastName (@collector.Role)</option>
											}
										}
									</select>
									<span asp-validation-for="CollectorId" class="text-danger"></span>
								</div>
							</div>
						</div>

						<!-- Route Dropdown -->
						<!-- Replace your Route dropdown section with this: -->
						<div class="form-group mb-3">
							<label asp-for="RouteId" class="form-label">
								<i class="fas fa-route"></i> Select Route
							</label>
							<select asp-for="RouteId" class="form-select" required>
								<option value="">-- Select Route --</option>
								@if (ViewBag.Routes != null)
								{
									@foreach (var route in ViewBag.Routes)
									{
										<option value="@route.Id.ToString()">
											@route.Name
											@if (!string.IsNullOrEmpty(route.Description))
											{
												<span>- @route.Description</span>
											}
											(@route.ExpectedDurationMinutes min)
										</option>
									}
								}
							</select>
							<span asp-validation-for="RouteId" class="text-danger"></span>
						</div>
						@* <div class="form-group mb-3"> *@
						@* 	<label asp-for="RouteId" class="form-label"> *@
						@* 		<i class="fas fa-route"></i> Select Route *@
						@* 	</label> *@
						@* 	<select asp-for="RouteId" class="form-select" required> *@
						@* 		<option value="">-- Select Route --</option> *@
						@* 		@if (ViewBag.Routes != null) *@
						@* 		{ *@
						@* 			@foreach (var route in ViewBag.Routes) *@
						@* 			{ *@
						@* 				<option value="@route.Id"> *@
						@* 					@route.Name *@
						@* 					@if (!string.IsNullOrEmpty(route.Description)) *@
						@* 					{ *@
						@* 						<span>- @route.Description</span> *@
						@* 					} *@
						@* 					(@route.ExpectedDurationMinutes min) *@
						@* 				</option> *@
						@* 			} *@
						@* 		} *@
						@* 	</select> *@
						@* 	<span asp-validation-for="RouteId" class="text-danger"></span> *@
						@* </div> *@

						<div class="row">
							<div class="col-md-6">
								<!-- Start Time -->
								<div class="form-group mb-3">
									<label asp-for="ScheduleStartTime" class="form-label">
										<i class="fas fa-clock"></i> Start Time
									</label>
									<input asp-for="ScheduleStartTime" class="form-control" type="datetime-local" required />
									<span asp-validation-for="ScheduleStartTime" class="text-danger"></span>
								</div>
							</div>

							<div class="col-md-6">
								<!-- End Time -->
								<div class="form-group mb-3">
									<label asp-for="ScheduleEndTime" class="form-label">
										<i class="fas fa-clock"></i> End Time
									</label>
									<input asp-for="ScheduleEndTime" class="form-control" type="datetime-local" required />
									<span asp-validation-for="ScheduleEndTime" class="text-danger"></span>
								</div>
							</div>
						</div>

						<!-- Status Dropdown -->
						<div class="form-group mb-3">
							<label asp-for="Status" class="form-label">
								<i class="fas fa-flag"></i> Status
							</label>
							<select asp-for="Status" class="form-select" required>
								<option value="">-- Select Status --</option>
								<option value="Scheduled" selected>Scheduled</option>
								<option value="In Progress">In Progress</option>
								<option value="Completed">Completed</option>
								<option value="Cancelled">Cancelled</option>
							</select>
							<span asp-validation-for="Status" class="text-danger"></span>
						</div>

						<!-- Notes -->
						<div class="form-group mb-4">
							<label asp-for="AdminNotes" class="form-label">
								<i class="fas fa-sticky-note"></i> Admin Notes
							</label>
							<textarea asp-for="AdminNotes" class="form-control" rows="3" placeholder="Optional notes about this schedule..."></textarea>
							<span asp-validation-for="AdminNotes" class="text-danger"></span>
						</div>

						<!-- Submit Buttons -->
						<div class="form-group d-flex gap-2">
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-save"></i> Create Schedule
							</button>
							<a asp-action="Index" class="btn btn-secondary">
								<i class="fas fa-arrow-left"></i> Back to List
							</a>
							<a asp-controller="Truck" asp-action="Index" class="btn btn-info" target="_blank">
								<i class="fas fa-truck"></i> Manage Trucks
							</a>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
